<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Reproducible Workflows for Ecology Research</title>
    <meta charset="utf-8" />
    <meta name="author" content="Eric Scott" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Reproducible Workflows for Ecology Research
### Eric Scott
### University of Florida
### 2018/10/11 (updated: 2021-05-28)

---






# Reproducibility: why bother?

- For future you

--

- For collaborators

--

- Because you want people to use and appreciate your data and code

--

- Because it is encouraged or required by a journal

--

- Open Science!

---
class: center, middle, inverse

# Organizing Files

---

# Directory Structure

At minimum, separate data from code and outputs.

.pull-left[
Minimally:

üìÅ data

üìÇ analysis

üìÇ output

üìù README.md
]

.pull-right[
I like:

üìÅ data
 - üìÅ raw_data
 - üìÅ cleaned_data
 - üìÉ README.md
 
üìÇ wrangling

üìÅ analysis

üìÇ docs
  - üìÅ figures
  
üìù README.md
]

---

# File paths in code

If I send you code that starts with the following lines, what are some problems you're going to have?

```r
setwd("~/Documents/myanalysis")
df &lt;- read.csv("data/mydata.csv")
```

--

- Different working directory

--

- "`~`" and "`/`" are linux &amp; macOS things and maybe you are running Windows

--

- Not totally clear where to put `mydata.csv` relative to the script
---

# File path solutions:

1. Use RStudio Projects‚Äîfile paths are relative
  - Working directory is always wherever the `.Rproj` file is by default.
  
2. Share entire Project folder when collaborating

2. Use the `here` package:


```r
library(here)
```

```
## here() starts at /Users/scottericr/Documents/reproducibility-presentation
```

Instead of ...
```r
read.csv("/Users/scottericr/Documents/reproducibility-presentation/data/trees.csv")
```
... use ...
```r
read.csv(here("data", "trees.csv"))
```

and it will work on any system!

---

# Don't edit raw data!

Never edit raw data directly. Do all data manipulation programatically when possible.

.pull-left[
- Keeps a record of all changes made to data

- Minimize accidental changes in data

- Consider making raw data files read-only

- Avoid Excel as it greedily converts things to dates!

- If you must edit manually, work on a copy and document the changes
]
.pull-right[
&lt;img src="img/excel_incel_venn.jpeg"/&gt;
]
---

# File naming

&lt;img src="img/filenames.png" width="1931" /&gt;

Considering alphabetical ordering of numbers
- Numbering (`01_wrangle-data.Rmd`, `02_analyze-data.Rmd`)
- Dates using ISO format (YYYY-MM-DD) (`2021-05-24_BDFFP-data.csv`)

---

# Tools to help you get organized

The [`workflowr` package](https://jdblischak.github.io/workflowr/) has tools to set up an RStudio Project as a reproducible research compendium.

- creates directory structure with readme and license
- sets up version control
- makes everything into a website
- nifty, but probably overkill

---
class: center, middle, inverse

# Documentation

---
# Metadata

Metadata is documentation of data‚Äîhow, where, when, and by whom it was collected.

Emilio has an entire lecture on metadata, if you want to go into depth.

At minimum, for "rectangular" data (a dataframe):

- What experiment is the dataset from?

- What do the column names mean?

- What are the units?

- What values should be expected and what do they mean?

Put this in a `README.md` or `metadata.md` inside your `data` folder.

---
# Commenting code

Bad:

```r
mean(iris[iris$Species=="setosa",]$Sepal.Length*iris[iris$Species=="setosa",]$Sepal.Width)
```

```
## [1] 17.2578
```

Good (split into steps, commented, some formatting):

```r
# subset to just setosa
iris_setosa &lt;- iris[iris$Species == "setosa", ]
# calculate an "area" of the sepals
iris_setosa$square_area &lt;-
  iris_setosa$Sepal.Length * iris_setosa$Sepal.Width
mean(iris_setosa$square_area)
```

```
## [1] 17.2578
```

**Tip:** You can automatically format your code in RStudio with *Code &gt; Reformat Code*
---
# Commenting code

Better (**literate programming** + comments):

```r
iris %&gt;%
  filter(Species == "setosa") %&gt;% 
  # calculate "area" of sepals
  mutate(square_area = Sepal.Length * Sepal.Width) %&gt;% 
  summarize(mean_sq_area = mean(square_area))
```

```
##   mean_sq_area
## 1      17.2578
```
One advantage of using the `tidyverse` packages is code that is more human readable, and you often need fewer comments to make it clear.

---
# RMarkdown

- Allows you to combine prose (markdown), code, and code output in one document

- Great way to keep an analysis "lab notebook"

- Creates nifty looking reports in HTML, pdf, Word using the `knitr` package

RMarkdown is not essential to reproducible code, but I personally find it helps me work though analyses and can eventually be turned into a report, or even into a simpler .R file with `knitr::purl()`

---
class: center, middle, inverse

# Programming

---

# Don't Repeat Yourself (DRY)

If you find yourself writing the same code 3+ times, consider writing a function. Functions let you re-use code and reduce mistakes when copying or updating code.

To define a function in R, you use the `function()` function:


```r
add_ten &lt;- function(x) {
  x + 10
}
add_ten(7)
```

```
## [1] 17
```

---

# Functions

RStudio can help you get started with *Code &gt; Extract Function*.  

It turns this:
```r
x &lt;- c(1,5,10)
y &lt;- 100

x * 2 + y
```

Into:


```r
my_fun &lt;- function(x, y) {
  x * 2 + y
}
```

Which let's you reuse code:

```r
my_fun(x = c(5,6,7), y = 10)
```

```
## [1] 20 22 24
```

---
class: center, middle, inverse

# Dependencies

---
# Package versions

Your code works now, but what if a key package gets updated or taken off CRAN?

The `renv` package keeps track of the specific versions of every package your project uses in a "lockfile"


&lt;img src="img/preferences.png"/, width=75%&gt;


---
# Create an R Package?

Some folks strongly believe that an R package is the perfect format for a reproducible research compendium.  **I am not one of those people.**

Creating an R package is not hard, but it does require extra effort and learning, and the payoff varies.

**However**, I do think R packages are a great way to share your *functions* and maybe sometimes your *data* if you expect them to be used by a wider community.

Check out https://r-pkgs.org/ if you want to try your hand at building an R package.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
